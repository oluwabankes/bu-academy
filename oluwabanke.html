<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Babcock Academy - Dynamic Portal</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FIX: Load MathJax for LaTeX Rendering -->
    <script>
        // Configuration for MathJax to handle inline math enclosed in \(...\)
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']]
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Load Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, onSnapshot, collection, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase and State variables accessible to the main script
        window.firebase = {};
        window.firebase.db = null;
        window.firebase.auth = null;
        window.firebase.userId = null;
        window.appState = {
            docId: null, // Firestore document ID for the user's application/bio
            isLoggedIn: false
        };

        // Initialize Firebase
        function initializeFirebase() {
            setLogLevel('Debug');
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-babcock-app-id';
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

            if (Object.keys(firebaseConfig).length === 0) {
                console.error("Firebase config is missing.");
                return;
            }

            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);

            window.firebase.db = db;
            window.firebase.auth = auth;
            window.firebase.appId = appId;


            // Authentication Listener
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    window.firebase.userId = user.uid;
                    loadApplicationData();
                    loadCampusPosts();
                } else {
                    window.firebase.userId = null;
                }
            });

            // Handle initial authentication (using custom token or anonymous sign-in)
            async function handleAuth() {
                try {
                    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log("Signed in with custom token.");
                    } else {
                        await signInAnonymously(auth);
                        console.log("Signed in anonymously.");
                    }
                } catch (error) {
                    console.error("Firebase Auth Error:", error);
                }
            }
            handleAuth();
        }

        // --- Firestore Paths ---

        // Path for private user data (application/bio)
        function getUserAppDocRef(db, userId) {
            const appId = window.firebase.appId;
            return collection(db, `artifacts/${appId}/users/${userId}/applications`);
        }

        // Path for public, shared campus posts
        function getPublicPostsCollection(db) {
             const appId = window.firebase.appId;
            return collection(db, `artifacts/${appId}/public/data/campus-posts`);
        }


        // --- Application Data (Private) ---

        async function saveApplicationData(data) {
            const { db, userId } = window.firebase;
            if (!db || !userId) return displayMessage('Error: User not authenticated.', 'error');

            try {
                const dataToSave = {
                    ...data,
                    userId: userId,
                    timestamp: new Date().toISOString(),
                    status: 'Submitted'
                };

                if (window.appState.docId) {
                    // Update existing document
                    const docRef = doc(getUserAppDocRef(db, userId), window.appState.docId);
                    await updateDoc(docRef, dataToSave);
                    displayMessage('Bio updated successfully!', 'success');
                } else {
                    // Add new document (Initial application submission)
                    await addDoc(getUserAppDocRef(db, userId), dataToSave);
                    displayMessage('Application submitted successfully!', 'success');
                }
                
                // Update UI to show submission status
                const statusMsg = document.getElementById('application-status-message');
                if(statusMsg) {
                    statusMsg.textContent = 'Application Submitted!';
                    statusMsg.className = 'text-sm text-center font-semibold mb-4 text-secondary';
                }

            } catch (e) {
                console.error("Error saving document: ", e);
                displayMessage('Error submitting application/bio. Check console.', 'error');
            }
        }

        function loadApplicationData() {
            const { db, userId } = window.firebase;
            if (!db || !userId) return;

            const q = query(getUserAppDocRef(db, userId), where("userId", "==", userId));

            onSnapshot(q, (snapshot) => {
                const portalNameEl = document.getElementById('portal-student-name');
                const portalProgramEl = document.getElementById('portal-program');
                const portalBioNameEl = document.getElementById('bio-full-name');
                const portalBioProgramEl = document.getElementById('bio-program');

                if (!snapshot.empty) {
                    const doc = snapshot.docs[0];
                    const appData = doc.data();
                    window.appState.docId = doc.id; // Store the document ID
                    console.log("Application data received:", appData);

                    // Update Student Portal UI
                    if(portalNameEl) portalNameEl.textContent = appData.fullName || 'Student Name Missing';
                    if(portalProgramEl) portalProgramEl.textContent = appData.program || 'Program Not Specified';
                    document.getElementById('portal-id').textContent = 'User ID: ' + userId.substring(0, 8) + '...';

                    // Update Bio Form fields
                    if(portalBioNameEl) portalBioNameEl.value = appData.fullName || '';
                    if(portalBioProgramEl) portalBioProgramEl.value = appData.program || '';

                } else {
                    window.appState.docId = null;
                    console.log("No application data found for user.");
                }
            }, (error) => {
                console.error("Error loading application data:", error);
            });
        }

        // --- Campus Posts (Public) ---

        async function saveCampusPost(post) {
            const { db, userId } = window.firebase;
            if (!db || !userId) return displayMessage('Error: Login to post to the gallery.', 'error');

            try {
                const dataToSave = {
                    ...post,
                    posterId: userId,
                    timestamp: new Date().toISOString(),
                };
                await addDoc(getPublicPostsCollection(db), dataToSave);
                displayMessage('Post added to Campus Gallery!', 'success');
                document.getElementById('post-form').reset();

            } catch (e) {
                console.error("Error saving campus post: ", e);
                displayMessage('Error submitting post. Check console.', 'error');
            }
        }

        function loadCampusPosts() {
            const { db } = window.firebase;
            if (!db) return;

            // Note: We avoid orderBy here to prevent index missing errors, and sort locally.
            const postsRef = getPublicPostsCollection(db);

            onSnapshot(postsRef, (snapshot) => {
                const postsContainer = document.getElementById('campus-posts-container');
                if (!postsContainer) return;

                const posts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // Sort posts locally by timestamp (newest first)
                posts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                postsContainer.innerHTML = ''; // Clear existing posts

                if (posts.length === 0) {
                    postsContainer.innerHTML = '<p class="text-center text-gray-500 col-span-full">No posts yet! Be the first to share.</p>';
                    return;
                }

                posts.forEach(post => {
                    const postElement = `
                        <div class="bg-card-bg rounded-xl shadow-lg overflow-hidden border border-gray-100">
                            <img src="${post.imageUrl}" alt="${post.caption}" 
                                class="w-full h-48 object-cover" 
                                onerror="this.onerror=null; this.src='https://placehold.co/400x300/e5e7eb/6b7280?text=Image+Unavailable';"
                            >
                            <div class="p-4">
                                <p class="text-gray-900 font-semibold mb-2">${post.caption}</p>
                                <p class="text-xs text-gray-500">Posted by User: ${post.posterId.substring(0, 8)}... on ${new Date(post.timestamp).toLocaleDateString()}</p>
                            </div>
                        </div>
                    `;
                    postsContainer.innerHTML += postElement;
                });

            }, (error) => {
                console.error("Error loading campus posts:", error);
            });
        }


        // Global functions accessible to the main script
        function displayMessage(message, type) {
            const msgBox = document.getElementById('global-message-box');
            msgBox.textContent = message;
            msgBox.className = `p-3 rounded-lg text-white font-semibold mb-4 text-center mx-auto max-w-5xl ${type === 'success' ? 'bg-secondary' : 'bg-red-500'}`;
            msgBox.classList.remove('hidden');
            setTimeout(() => msgBox.classList.add('hidden'), 5000);
        }

        window.displayMessage = displayMessage;
        window.saveApplicationData = saveApplicationData;
        window.saveCampusPost = saveCampusPost;

        // Start Firebase initialization
        initializeFirebase();

    </script>
    <style>
        /* Custom styles for the Inter font and smooth scrolling */
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
            background-color: #f7f9fb;
        }
        /* Style for active navigation links */
        .nav-link:hover {
            color: #22c55e;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#053e77', /* Deep Navy Blue (Babcock primary color inspired) */
                        'secondary': '#22c55e', /* Emerald Green for accents */
                        'background': '#f7f9fb',
                        'card-bg': '#ffffff',
                    }
                }
            }
        }
    </script>
</head>
<body class="antialiased">

    <!-- Header & Navigation Bar -->
    <header class="sticky top-0 z-50 bg-white shadow-md">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo/Title -->
                <div class="flex-shrink-0">
                    <a href="#" onclick="showView('home'); return false;" class="text-2xl font-extrabold text-primary rounded-lg p-1.5 transition duration-300 hover:bg-primary/10">
                        <span class="text-secondary">Babcock</span> Academy
                    </a>
                </div>

                <!-- Desktop Navigation Links -->
                <nav class="hidden md:flex space-x-6">
                    <a href="#home" onclick="showView('home'); return false;" class="nav-link text-gray-700 font-medium transition duration-150">Home</a>
                    <a href="#academics" onclick="document.getElementById('view-home').scrollIntoView({behavior: 'smooth'}); return false;" class="nav-link text-gray-700 font-medium transition duration-150">Academics</a>
                    <a href="#" onclick="showView('application'); return false;" class="nav-link text-gray-700 font-medium transition duration-150">Admissions</a>
                    <a href="#" onclick="showView('media-gallery'); return false;" class="nav-link text-gray-700 font-medium transition duration-150">Campus Life</a>
                    <a href="#" onclick="checkAuthAndShowPortal(); return false;" class="nav-link text-gray-700 font-medium transition duration-150">Student Portal</a>
                    <a href="#contact" onclick="document.getElementById('view-home').scrollIntoView({behavior: 'smooth'}); return false;" class="nav-link text-gray-700 font-medium transition duration-150">Contact Us</a>
                </nav>

                <!-- Login Button -->
                <button onclick="checkAuthAndShowPortal()" id="login-nav-btn" class="hidden md:block bg-secondary text-white px-4 py-2 rounded-lg font-semibold shadow-lg transition duration-300 hover:bg-secondary/90 hover:shadow-xl">
                    Student Login
                </button>

                <!-- Mobile Menu Button (Hamburger) -->
                <button id="mobile-menu-button" class="md:hidden text-gray-500 hover:text-primary focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
            </div>
        </div>

        <!-- Mobile Menu Dropdown -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#home" onclick="showView('home'); return false;" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Home</a>
                <a href="#academics" onclick="showView('curricula'); return false;" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Academics</a>
                <a href="#" onclick="showView('application'); return false;" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Admissions</a>
                <a href="#" onclick="showView('media-gallery'); return false;" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Campus Life</a>
                <a href="#" onclick="checkAuthAndShowPortal(); return false;" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Student Portal</a>
                <a href="#contact" onclick="showView('home'); return false;" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Contact Us</a>
                <button onclick="checkAuthAndShowPortal()" class="block w-full bg-secondary text-white px-3 py-2 rounded-lg text-center font-semibold mt-2 hover:bg-secondary/90">Student Login</button>
            </div>
        </div>
    </header>

    <main id="app-content">

        <!-- Global Message Box (for Firebase status) -->
        <div id="global-message-box" class="hidden mx-auto max-w-5xl mt-4"></div>

        <!-- Bio Update Modal -->
        <div id="bio-update-modal" class="modal hidden">
            <div class="bg-card-bg p-8 rounded-2xl shadow-2xl w-full max-w-lg mx-4">
                <h3 class="text-2xl font-bold text-primary mb-6">Update Student Bio</h3>
                <form id="bio-update-form" onsubmit="handleBioUpdate(event)">
                    <label class="block mb-4">
                        <span class="text-gray-700">Full Name</span>
                        <input type="text" id="bio-full-name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary/50 p-2">
                    </label>
                    <label class="block mb-6">
                        <span class="text-gray-700">Program of Study</span>
                        <select id="bio-program" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary/50 p-2 bg-white">
                            <option value="Software Engineering">Software Engineering</option>
                            <option value="Cybersecurity">Cybersecurity</option>
                            <option value="Accounting">Accounting</option>
                            <option value="Law">Law</option>
                            <option value="Unspecified">Unspecified</option>
                        </select>
                    </label>
                    <div class="flex justify-end space-x-4">
                        <button type="button" onclick="closeBioModal()" class="bg-gray-400 text-white px-4 py-2 rounded-lg font-semibold hover:bg-gray-500">Cancel</button>
                        <button type="submit" class="bg-secondary text-white px-4 py-2 rounded-lg font-bold hover:bg-secondary/90">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>


        <!-- Home View (default) -->
        <div id="view-home" class="view">
            <!-- Hero Section -->
            <section id="home" class="py-20 md:py-32 bg-primary text-white text-center shadow-inner">
                <div class="container mx-auto px-4">
                    <h1 class="text-4xl sm:text-6xl font-extrabold mb-4 leading-tight">
                        Babcock Academy: Where Leaders Are Made
                    </h1>
                    <p class="text-xl sm:text-2xl font-light mb-8 max-w-3xl mx-auto">
                        Excellence in education, grounded in integrity and service.
                    </p>
                    <div class="flex justify-center space-x-4">
                        <button onclick="showView('application')" class="bg-secondary text-white px-8 py-3 rounded-xl text-lg font-bold shadow-2xl transition duration-300 transform hover:scale-105 hover:bg-secondary/90">
                            Start Your Application
                        </button>
                        <button onclick="showView('curricula')" class="bg-white text-primary border border-white px-8 py-3 rounded-xl text-lg font-bold shadow-2xl transition duration-300 transform hover:scale-105 hover:bg-gray-100">
                            Explore Curricula
                        </button>
                    </div>
                </div>
            </section>

            <!-- Academic Preview Section (Links to Curricula View) -->
            <section id="academics" class="py-16 bg-background">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <h2 class="text-4xl font-bold text-gray-800 text-center mb-12">Our Academic Programs</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="bg-card-bg p-6 rounded-2xl shadow-xl hover:shadow-2xl transition duration-300 border-t-4 border-primary">
                            <h3 class="text-2xl font-semibold text-gray-900 mb-3">Computing & Engineering</h3>
                            <p class="text-gray-600 mb-4">World-class training in Software Engineering, Cybersecurity, and Mechanical Design.</p>
                            <button onclick="showView('curricula')" class="text-primary font-medium hover:text-primary/80">View Curricula &rarr;</button>
                        </div>
                        <div class="bg-card-bg p-6 rounded-2xl shadow-xl hover:shadow-2xl transition duration-300 border-t-4 border-secondary">
                            <h3 class="text-2xl font-semibold text-gray-900 mb-3">Law & Security Studies</h3>
                            <p class="text-gray-600 mb-4">Developing ethical and competent legal professionals for global challenges.</p>
                             <button onclick="showView('curricula')" class="text-secondary font-medium hover:text-secondary/80">View Curricula &rarr;</button>
                        </div>
                        <div class="bg-card-bg p-6 rounded-2xl shadow-xl hover:shadow-2xl transition duration-300 border-t-4 border-yellow-500">
                            <h3 class="text-2xl font-semibold text-gray-900 mb-3">Business & Finance</h3>
                            <p class="text-gray-600 mb-4">Accredited programs in Accounting, Economics, and specialized Management fields.</p>
                            <button onclick="showView('curricula')" class="text-yellow-500 font-medium hover:text-yellow-400">View Curricula &rarr;</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Campus Life Section (Links to Media Gallery View) -->
            <section id="campuslife" class="py-16 bg-white">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <h2 class="text-4xl font-bold text-gray-800 text-center mb-12">Campus Life: A Balanced Experience</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- Updated: Links to the new Faith & Service view -->
                        <button onclick="showView('faith-service')" class="bg-card-bg p-5 rounded-xl shadow-lg text-center hover:bg-primary/10 transition duration-300">
                            <img src="https://placehold.co/100x100/053e77/ffffff?text=Faith" alt="Faith Icon" class="mx-auto mb-3 w-16 h-16 rounded-full border-4 border-primary/50">
                            <h4 class="font-semibold text-lg mb-1">Faith & Service</h4>
                            <p class="text-sm text-gray-600">See community outreach & activities.</p>
                        </button>
                        <button onclick="showView('media-gallery')" class="bg-card-bg p-5 rounded-xl shadow-lg text-center hover:bg-primary/10 transition duration-300">
                            <img src="https://placehold.co/100x100/22c55e/ffffff?text=Sports" alt="Sports Icon" class="mx-auto mb-3 w-16 h-16 rounded-full border-4 border-secondary/50">
                            <h4 class="font-semibold text-lg mb-1">Recreation & Sports</h4>
                            <p class="text-sm text-gray-600">View sports and fitness photos.</p>
                        </button>
                        <button onclick="showView('media-gallery')" class="bg-card-bg p-5 rounded-xl shadow-lg text-center hover:bg-primary/10 transition duration-300">
                            <img src="https://placehold.co/100x100/f59e0b/ffffff?text=Resid" alt="Residency Icon" class="mx-auto mb-3 w-16 h-16 rounded-full border-4 border-yellow-500/50">
                            <h4 class="font-semibold text-lg mb-1">Residential Living</h4>
                            <p class="text-sm text-gray-600">Check out hostel and campus views.</p>
                        </button>
                        <button onclick="showView('media-gallery')" class="bg-card-bg p-5 rounded-xl shadow-lg text-center hover:bg-primary/10 transition duration-300">
                            <img src="https://placehold.co/100x100/ef4444/ffffff?text=Safety" alt="Safety Icon" class="mx-auto mb-3 w-16 h-16 rounded-full border-4 border-red-500/50">
                            <h4 class="font-semibold text-lg mb-1">Security & Welfare</h4>
                            <p class="text-sm text-gray-600">Post event photos and updates.</p>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Contact Section -->
            <section id="contact" class="py-16 bg-primary text-white">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                    <h2 class="text-3xl font-bold mb-4">Need Assistance?</h2>
                    <p class="text-lg font-light mb-8 max-w-2xl mx-auto">
                        Contact the Admissions Office or the Student Affairs Unit for specialized support.
                    </p>
                    <div class="flex justify-center space-x-6">
                        <a href="mailto:admissions@babcock.edu" class="flex items-center space-x-2 font-semibold hover:text-secondary transition duration-150">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                            <span>admissions@babcock.edu</span>
                        </a>
                        <a href="tel:+15551234567" class="flex items-center space-x-2 font-semibold hover:text-secondary transition duration-150">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.717 21 3 14.283 3 6V5z"></path></svg>
                            <span>+234 (0) 800 123 4567</span>
                        </a>
                    </div>
                </div>
            </section>
        </div>

        <!-- NEW: Faith & Service View (Official Content) -->
        <div id="view-faith-service" class="view hidden py-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-4xl font-bold text-primary text-center mb-4">Our Heritage: Faith, Service, and Excellence</h2>
                <p class="text-center text-lg text-gray-600 mb-10 max-w-3xl mx-auto">Babcock Academy is a Seventh-day Adventist institution committed to developing the whole person—mind, body, and spirit—through a holistic Christian education.</p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    
                    <!-- Image 1: SDA Heritage -->
                    <div class="bg-card-bg rounded-2xl shadow-xl overflow-hidden">
                        <img src="https://placehold.co/600x400/053e77/ffffff?text=Babcock+SDA+Heritage" 
                            alt="Babcock University Campus Sign with SDA Logo" 
                            class="w-full h-64 object-cover" 
                            onerror="this.onerror=null; this.src='https://placehold.co/600x400/053e77/ffffff?text=Babcock+SDA+Heritage';">
                        <div class="p-6">
                            <h3 class="text-xl font-semibold text-primary mb-2">Our Foundation</h3>
                            <p class="text-gray-600">Established on the core values of the Seventh-day Adventist Church, we instill strong moral and ethical principles, preparing students for purposeful lives of service.</p>
                        </div>
                    </div>

                    <!-- Image 2: Worship and Fellowship -->
                    <div class="bg-card-bg rounded-2xl shadow-xl overflow-hidden">
                        <img src="https://placehold.co/600x400/22c55e/ffffff?text=Worship+Center" 
                            alt="Interior of a large campus worship center" 
                            class="w-full h-64 object-cover" 
                            onerror="this.onerror=null; this.src='https://placehold.co/600x400/22c55e/ffffff?text=Worship+Center';">
                        <div class="p-6">
                            <h3 class="text-xl font-semibold text-secondary mb-2">A Place of Worship</h3>
                            <p class="text-gray-600">The beautiful campus church is the center of spiritual life, offering regular services, fellowship opportunities, and Bible study groups throughout the week.</p>
                        </div>
                    </div>

                    <!-- Image 3: Music and Ministry -->
                    <div class="bg-card-bg rounded-2xl shadow-xl overflow-hidden">
                        <img src="https://placehold.co/600x400/f59e0b/ffffff?text=Campus+Choir" 
                            alt="Campus choir performing on stage" 
                            class="w-full h-64 object-cover" 
                            onerror="this.onerror=null; this.src='https://placehold.co/600x400/f59e0b/ffffff?text=Campus+Choir';">
                        <div class="p-6">
                            <h3 class="text-xl font-semibold text-yellow-700 mb-2">Active Ministries</h3>
                            <p class="text-gray-600">Students actively participate in various campus ministries, including choir, music groups, and community outreach, nurturing talents for God's service.</p>
                        </div>
                    </div>

                    <!-- Image 4: Commitment to Service -->
                    <div class="bg-card-bg rounded-2xl shadow-xl overflow-hidden">
                        <img src="https://placehold.co/600x400/ef4444/ffffff?text=Graduation+Pledge" 
                            alt="Graduating students standing with hands over hearts" 
                            class="w-full h-64 object-cover" 
                            onerror="this.onerror=null; this.src='https://placehold.co/600x400/ef4444/ffffff?text=Graduation+Pledge';">
                        <div class="p-6">
                            <h3 class="text-xl font-semibold text-red-500 mb-2">Graduation Pledge</h3>
                            <p class="text-gray-600">Our education culminates in a commitment to integrity and service, reflected in solemn ceremonies where students pledge their lives to be responsible, moral leaders.</p>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-12">
                    <button onclick="showView('home')" class="bg-primary text-white px-6 py-3 rounded-xl text-lg font-bold shadow-2xl transition duration-300 transform hover:scale-105 hover:bg-primary/90">
                        Return to Home
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Curricula View -->
        <div id="view-curricula" class="view hidden py-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-4xl font-bold text-primary text-center mb-10">Detailed Program Curricula</h2>
                <div class="max-w-4xl mx-auto space-y-8">
                    <!-- Program 1: Computing & Engineering -->
                    <div class="bg-card-bg p-6 rounded-xl shadow-lg border-l-4 border-primary">
                        <h3 class="text-2xl font-bold text-gray-800 mb-3">Computing & Engineering (B.Eng/B.Sc)</h3>
                        <p class="text-gray-600 mb-4">Focus areas: Software Engineering, Mechanical Engineering, Electrical and Electronics Engineering.</p>
                        <ul class="list-disc ml-6 text-gray-700 space-y-1">
                            <li>**Year 1 Core:** \(\text{MTH}\ 101\) (Calculus), \(\text{CHM}\ 101\) (General Chemistry), \(\text{GNS}\ 101\) (Use of English).</li>
                            <li>**Year 2 Foundational:** \(\text{CSC}\ 201\) (Introduction to Programming), \(\text{ENG}\ 205\) (Engineering Graphics).</li>
                            <li>**Year 3 Specialization:** \(\text{SFE}\ 315\) (Data Structures and Algorithms), \(\text{SFE}\ 322\) (Database Systems).</li>
                            <li>**Final Year:** Project Thesis, Industrial Training, \(\text{CYS}\ 410\) (Cybersecurity Principles).</li>
                        </ul>
                    </div>

                    <!-- Program 2: Law & Security Studies -->
                    <div class="bg-card-bg p-6 rounded-xl shadow-lg border-l-4 border-secondary">
                        <h3 class="text-2xl font-bold text-gray-800 mb-3">Law & Security Studies (LL.B)</h3>
                        <p class="text-gray-600 mb-4">Rigorous training in jurisprudence, constitutional law, and international security.</p>
                        <ul class="list-disc ml-6 text-gray-700 space-y-1">
                            <li>**Year 1 Core:** \(\text{JUR}\ 101\) (Introduction to Law), \(\text{POL}\ 101\) (Political Science).</li>
                            <li>**Year 2 Foundational:** \(\text{LAW}\ 201\) (Nigerian Legal System), \(\text{LAW}\ 204\) (Law of Contract).</li>
                            <li>**Year 3 Specialization:** \(\text{LAW}\ 308\) (Criminal Law), \(\text{LAW}\ 315\) (Equity and Trusts).</li>
                            <li>**Final Year:** Moot Court, Legal Aid Clinic, \(\text{ISY}\ 405\) (International Security).</li>
                        </ul>
                    </div>

                    <!-- Program 3: Business & Finance -->
                    <div class="bg-card-bg p-6 rounded-xl shadow-lg border-l-4 border-yellow-500">
                        <h3 class="text-2xl font-bold text-gray-800 mb-3">Business & Finance (B.Sc)</h3>
                        <p class="text-gray-600 mb-4">Equipping students with analytical and managerial skills for the modern economy.</p>
                        <ul class="list-disc ml-6 text-gray-700 space-y-1">
                            <li>**Year 1 Core:** \(\text{ACC}\ 101\) (Principles of Accounting), \(\text{ECO}\ 101\) (Principles of Economics).</li>
                            <li>**Year 2 Foundational:** \(\text{MKT}\ 203\) (Introduction to Marketing), \(\text{FIN}\ 201\) (Business Finance).</li>
                            <li>**Year 3 Specialization:** \(\text{ACC}\ 310\) (Taxation), \(\text{MGT}\ 305\) (Operations Management).</li>
                            <li>**Final Year:** Business Strategy Project, Entrepreneurship Seminar, \(\text{ECO}\ 415\) (Econometrics).</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Application View -->
        <div id="view-application" class="view hidden py-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-2xl">
                <h2 class="text-4xl font-bold text-primary text-center mb-8">Undergraduate Application Form</h2>
                <div class="bg-card-bg p-8 rounded-2xl shadow-2xl border-t-8 border-secondary">
                    <p id="application-status-message" class="text-sm text-center font-semibold mb-4 text-red-500">Please fill out the form below.</p>

                    <form id="application-form" onsubmit="submitApplication(event)">
                        <!-- Personal Details -->
                        <h3 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">1. Personal Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <label class="block">
                                <span class="text-gray-700">Full Name</span>
                                <input type="text" id="app-full-name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary/50 p-2">
                            </label>
                            <label class="block">
                                <span class="text-gray-700">Email Address</span>
                                <input type="email" id="app-email" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary/50 p-2">
                            </label>
                        </div>
                        <label class="block mb-6">
                            <span class="text-gray-700">Phone Number</span>
                            <input type="tel" id="app-phone" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary/50 p-2">
                        </label>

                        <!-- Program Details -->
                        <h3 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">2. Program Selection</h3>
                        <label class="block mb-6">
                            <span class="text-gray-700">Desired Program of Study</span>
                            <select id="app-program" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary/50 p-2 bg-white">
                                <option value="">Select a Program</option>
                                <option value="Software Engineering">Software Engineering</option>
                                <option value="Cybersecurity">Cybersecurity</option>
                                <option value="Accounting">Accounting</option>
                                <option value="Law">Law</option>
                            </select>
                        </label>

                        <!-- Declaration -->
                        <div class="mb-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                            <label class="inline-flex items-center">
                                <input type="checkbox" id="app-declaration" required class="rounded border-gray-300 text-secondary shadow-sm focus:border-secondary focus:ring-secondary/50">
                                <span class="ml-2 text-sm text-gray-700">I confirm that all information provided is accurate and truthful.</span>
                            </label>
                        </div>

                        <div class="flex justify-between">
                            <button type="button" onclick="showView('home')" class="bg-gray-400 text-white px-6 py-3 rounded-lg font-semibold transition duration-300 hover:bg-gray-500 shadow-md">
                                Cancel
                            </button>
                            <button type="submit" class="bg-primary text-white px-8 py-3 rounded-lg font-bold transition duration-300 hover:bg-primary/90 shadow-xl">
                                Submit Application
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Login View -->
        <div id="view-login" class="view hidden py-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-md">
                <h2 class="text-4xl font-bold text-primary text-center mb-8">Student Portal Access</h2>
                <div class="bg-card-bg p-8 rounded-2xl shadow-2xl border-t-8 border-primary">
                    <p class="text-center text-gray-600 mb-6">
                        Enter any username and password to log in (simulated environment).
                    </p>
                    <div id="login-message" class="text-center text-red-500 font-medium mb-4 hidden"></div>
                    <form id="login-form" onsubmit="handleLogin(event)">
                        <label class="block mb-4">
                            <span class="text-gray-700 font-medium">Username (or Student ID)</span>
                            <input type="text" id="login-username" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary/50 p-3">
                        </label>
                        <label class="block mb-6">
                            <span class="text-gray-700 font-medium">Password</span>
                            <input type="password" id="login-password" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary/50 p-3">
                        </label>
                        <button type="submit" class="w-full bg-secondary text-white px-4 py-3 rounded-lg font-bold shadow-lg transition duration-300 hover:bg-secondary/90">
                            Access Portal
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Protected Portal View -->
        <div id="view-portal" class="view hidden py-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-4xl font-bold text-primary">My Babcock Academy Portal</h2>
                    <button onclick="handleLogout()" class="bg-red-500 text-white px-4 py-2 rounded-lg font-semibold transition duration-300 hover:bg-red-600 shadow-md">
                        Logout
                    </button>
                </div>

                <div class="max-w-4xl mx-auto bg-card-bg p-8 rounded-2xl shadow-2xl border-t-8 border-secondary">
                    <div class="md:flex md:space-x-8">
                        <!-- Profile Card (Student Details) -->
                        <div class="md:w-1/3 text-center mb-8 md:mb-0">
                            <div class="relative w-40 h-40 mx-auto rounded-full overflow-hidden border-4 border-primary shadow-lg">
                                <img id="portal-id-pic" src="https://placehold.co/160x160/053e77/ffffff?text=Upload+ID+Pic"
                                     alt="Student Profile Picture"
                                     class="w-full h-full object-cover"
                                     onerror="this.onerror=null; this.src='https://placehold.co/160x160/053e77/ffffff?text=Placeholder';"
                                >
                            </div>
                            <h3 id="portal-student-name" class="text-2xl font-bold text-gray-900 mt-4">Loading Name...</h3>
                            <p id="portal-program" class="text-secondary font-medium">Loading Program...</p>
                            <p class="text-sm text-gray-500 mt-2">Authenticated User ID: <span id="portal-id" class="font-mono text-xs text-primary">Loading...</span></p>

                            <button onclick="openBioModal()" class="mt-4 bg-primary text-white px-4 py-2 rounded-lg text-sm transition duration-300 hover:bg-primary/90 shadow-md">
                                Update Bio
                            </button>
                            <button onclick="uploadIdPic()" class="mt-2 bg-yellow-500 text-white px-4 py-2 rounded-lg text-sm transition duration-300 hover:bg-yellow-600 shadow-md w-full">
                                Upload ID Photo
                            </button>
                        </div>

                        <!-- Academic & Media Details -->
                        <div class="md:w-2/3">
                            <h4 class="text-xl font-semibold border-b pb-2 mb-4 text-gray-800">Quick Academic Links</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-3 bg-gray-50 rounded-lg shadow-sm">
                                    <p class="text-sm text-gray-500">Current Semester GPA</p>
                                    <p class="text-2xl font-bold text-primary">4.0 (Simulated)</p>
                                </div>
                                <button onclick="showView('registration')" class="p-3 bg-yellow-100 rounded-lg font-semibold text-yellow-700 hover:bg-yellow-200 transition duration-150 flex items-center justify-center">Course Registration</button>
                                <button onclick="showView('grades')" class="p-3 bg-indigo-100 rounded-lg font-semibold text-indigo-700 hover:bg-indigo-200 transition duration-150 flex items-center justify-center">View Grades</button>
                                <button onclick="showView('fees')" class="p-3 bg-green-100 rounded-lg font-semibold text-green-700 hover:bg-green-200 transition duration-150 flex items-center justify-center">Pay Fees Online</button>
                            </div>

                            <h4 class="text-xl font-semibold border-b pb-2 mt-8 mb-4 text-gray-800">My Documents (Placeholder)</h4>
                            <p class="text-sm text-gray-600 mb-4">Upload critical documents here.</p>
                            <div class="grid grid-cols-3 gap-3">
                                <div class="aspect-square border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center text-gray-500 hover:border-primary hover:text-primary transition duration-150 cursor-pointer p-2">
                                    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                                    <span class="text-xs text-center">Upload Transcript</span>
                                </div>
                                <div class="aspect-square border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center text-gray-500 hover:border-primary hover:text-primary transition duration-150 cursor-pointer p-2">
                                    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                                    <span class="text-xs text-center">Upload Result Slip</span>
                                </div>
                                <div class="aspect-square border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center text-gray-500 hover:border-primary hover:text-primary transition duration-150 cursor-pointer p-2">
                                    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                                    <span class="text-xs text-center">Upload Other</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Course Registration View -->
        <div id="view-registration" class="view hidden py-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-3xl">
                <h2 class="text-4xl font-bold text-primary text-center mb-8">Course Registration</h2>
                <div class="bg-card-bg p-8 rounded-2xl shadow-2xl border-t-8 border-primary">
                    <p class="text-lg text-gray-600 mb-6">Welcome! Please select your courses for the current semester (2024/2025 Harmattan Semester). You must register for at least 15 units.</p>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="font-semibold text-gray-800">\(\text{SFE}\ 401\) - Advanced Software Engineering (4 Units)</span>
                            <button class="bg-secondary text-white px-4 py-1 rounded-full text-sm hover:bg-secondary/90">Add</button>
                        </div>
                         <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="font-semibold text-gray-800">\(\text{CYS}\ 405\) - Ethical Hacking (3 Units)</span>
                            <button class="bg-secondary text-white px-4 py-1 rounded-full text-sm hover:bg-secondary/90">Add</button>
                        </div>
                         <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="font-semibold text-gray-800">\(\text{GNS}\ 402\) - Entrepreneurship Studies (2 Units)</span>
                            <button class="bg-secondary text-white px-4 py-1 rounded-full text-sm hover:bg-secondary/90">Add</button>
                        </div>
                    </div>
                    <div class="mt-8 text-right">
                        <p class="text-xl font-bold text-primary mb-4">Total Units Selected: 9 / 15 (Minimum)</p>
                        <button class="bg-primary text-white px-6 py-3 rounded-lg font-bold shadow-xl opacity-50 cursor-not-allowed" disabled>
                            Submit Registration
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Grades View -->
        <div id="view-grades" class="view hidden py-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl">
                <h2 class="text-4xl font-bold text-primary text-center mb-8">Official Grade Report & Transcript</h2>
                <div class="bg-card-bg p-8 rounded-2xl shadow-2xl border-t-8 border-indigo-500">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">2023/2024 Semester 2 Results</h3>
                    <table class="min-w-full divide-y divide-gray-200 mb-6">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course Code</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course Title</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Units</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Grade</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Grade Point</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr><td class="px-6 py-4 whitespace-nowrap">\(\text{CSC}\ 201\)</td><td class="px-6 py-4 whitespace-nowrap">Introduction to Programming</td><td class="px-6 py-4 whitespace-nowrap">3</td><td class="px-6 py-4 whitespace-nowrap text-secondary font-bold">A</td><td class="px-6 py-4 whitespace-nowrap">5.0</td></tr>
                            <tr><td class="px-6 py-4 whitespace-nowrap">\(\text{MTH}\ 203\)</td><td class="px-6 py-4 whitespace-nowrap">Linear Algebra</td><td class="px-6 py-4 whitespace-nowrap">3</td><td class="px-6 py-4 whitespace-nowrap text-green-600 font-bold">B</td><td class="px-6 py-4 whitespace-nowrap">4.0</td></tr>
                            <tr><td class="px-6 py-4 whitespace-nowrap">\(\text{GNS}\ 201\)</td><td class="px-6 py-4 whitespace-nowrap">Logic and Philosophy</td><td class="px-6 py-4 whitespace-nowrap">2</td><td class="px-6 py-4 whitespace-nowrap text-red-600 font-bold">C</td><td class="px-6 py-4 whitespace-nowrap">3.0</td></tr>
                        </tbody>
                    </table>
                    <div class="text-right font-bold text-lg">
                        <p>Semester GPA: 4.14</p>
                        <p class="text-primary">Cumulative GPA: 4.02</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fees View -->
        <div id="view-fees" class="view hidden py-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-3xl">
                <h2 class="text-4xl font-bold text-primary text-center mb-8">Pay Fees Online</h2>
                <div class="bg-card-bg p-8 rounded-2xl shadow-2xl border-t-8 border-green-500">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Current Outstanding Fees</h3>
                    <div class="bg-red-100 border-l-4 border-red-500 p-4 mb-6">
                        <p class="font-bold text-red-700">Total Due: \(\text{NGN}\ 450,000\)</p>
                        <p class="text-sm text-red-600">Payment Deadline: September 30, 2024</p>
                    </div>
                    
                    <h3 class="text-xl font-semibold text-gray-800 mb-3">Payment Details</h3>
                    <label class="block mb-4">
                        <span class="text-gray-700">Amount to Pay (NGN)</span>
                        <input type="number" value="450000" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary/50 p-3">
                    </label>
                    <label class="block mb-6">
                        <span class="text-gray-700">Select Payment Method (Simulated)</span>
                        <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary/50 p-3 bg-white">
                            <option>Credit/Debit Card</option>
                            <option>Bank Transfer</option>
                            <option>QuickTeller</option>
                        </select>
                    </label>
                    
                    <button onclick="displayMessage('Payment simulation initiated. You would be redirected to a secure payment gateway.', 'success')" class="w-full bg-secondary text-white px-6 py-3 rounded-lg font-bold shadow-xl transition duration-300 hover:bg-secondary/90">
                        Proceed to Payment Gateway
                    </button>
                </div>
            </div>
        </div>

        <!-- Campus Life Media Gallery View (Student Uploads) -->
        <div id="view-media-gallery" class="view hidden py-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-4xl font-bold text-primary text-center mb-4">Campus Life: Shared Media Gallery (Student Posts)</h2>
                <p class="text-center text-gray-600 mb-8 max-w-2xl mx-auto">Share your campus moments, event photos, and academic projects with the community. (Requires Login)</p>

                <!-- Post Submission Form -->
                <div class="max-w-xl mx-auto mb-10 bg-white p-6 rounded-xl shadow-lg border-t-4 border-secondary">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Post to the Gallery</h3>
                    <form id="post-form" onsubmit="handlePostSubmit(event)">
                        <label class="block mb-4">
                            <span class="text-gray-700 text-sm">Image URL (Simulated Upload - Paste any URL)</span>
                            <input type="url" id="post-image-url" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-secondary focus:ring-secondary/50 p-2">
                        </label>
                         <label class="block mb-4">
                            <span class="text-gray-700 text-sm">Caption</span>
                            <input type="text" id="post-caption" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-secondary focus:ring-secondary/50 p-2">
                        </label>
                        <button type="submit" class="w-full bg-secondary text-white px-4 py-2 rounded-lg font-bold shadow-md transition duration-300 hover:bg-secondary/90">
                            Share Moment
                        </button>
                    </form>
                </div>

                <!-- Gallery Display -->
                <div id="campus-posts-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <p class="text-center text-gray-500 col-span-full">Loading campus posts...</p>
                </div>
            </div>
        </div>


    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm">
            <p>&copy; 2024 Babcock Academy. All rights reserved. | <a href="#" class="hover:text-primary">Legal</a> | <a href="#" class="hover:text-primary">Contact</a></p>
        </div>
    </footer>

    <script>
        // --- View Management and Authentication Check ---

        /**
         * Switches the displayed content view.
         * @param {string} viewId - The ID suffix of the view to show (e.g., 'home', 'application', 'login', 'portal').
         */
        function showView(viewId) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.add('hidden');
            });

            const targetView = document.getElementById(`view-${viewId}`);
            if (targetView) {
                targetView.classList.remove('hidden');
                window.scrollTo({ top: 0, behavior: 'smooth' });

                // Special logic for the portal view
                if (viewId === 'portal') {
                    // This runs when the user successfully logs in
                    updatePortalUI(window.firebase.userId);
                }
            } else {
                console.error(`View with ID 'view-${viewId}' not found.`);
            }
        }

        function checkAuthAndShowPortal() {
            if (window.appState.isLoggedIn) {
                showView('portal');
            } else {
                showView('login');
            }
        }


        // Default view on load
        document.addEventListener('DOMContentLoaded', () => {
            showView('home');
            // Mobile menu toggle logic
            const button = document.getElementById('mobile-menu-button');
            const menu = document.getElementById('mobile-menu');
            button.addEventListener('click', () => {
                menu.classList.toggle('hidden');
            });
            menu.querySelectorAll('a, button').forEach(link => {
                link.addEventListener('click', () => {
                    menu.classList.add('hidden');
                });
            });

        });

        // --- Application Form Submission Logic ---

        function submitApplication(event) {
            event.preventDefault();

            const fullName = document.getElementById('app-full-name').value.trim();
            const email = document.getElementById('app-email').value.trim();
            const phone = document.getElementById('app-phone').value.trim();
            const program = document.getElementById('app-program').value;
            const declaration = document.getElementById('app-declaration').checked;

            if (!declaration) {
                return displayMessage('Please confirm the declaration before submitting.', 'error');
            }

            const applicationData = {
                fullName,
                email,
                phone,
                program
            };

            // Call the globally available function from the module script to save to Firestore
            window.saveApplicationData(applicationData);
        }

        // --- Student Portal/Login/Logout Logic ---

        function handleLogin(event) {
            event.preventDefault();

            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            const msgBox = document.getElementById('login-message');
            msgBox.classList.add('hidden');

            // --- SIMULATED LOGIN ---
            if (username && password) {
                window.appState.isLoggedIn = true;
                msgBox.classList.remove('text-red-500');
                msgBox.classList.add('text-secondary');
                msgBox.textContent = 'Login successful! Redirecting...';
                msgBox.classList.remove('hidden');

                setTimeout(() => {
                    showView('portal');
                    msgBox.classList.add('hidden');
                }, 1000);

            } else {
                msgBox.classList.remove('text-secondary');
                msgBox.classList.add('text-red-500');
                msgBox.textContent = 'Please enter a username and password.';
                msgBox.classList.remove('hidden');
            }
        }

        function handleLogout() {
            window.appState.isLoggedIn = false;
            // In a real app, this would be: firebase.auth.signOut();
            displayMessage('You have been logged out.', 'success');
            showView('home');
        }

        function updatePortalUI(userId) {
            if (userId) {
                // Update the hidden input field in the Bio Modal with the current docId
                document.getElementById('portal-id').textContent = userId.substring(0, 8) + '...';
            }
            // Other fields (Name, Program) are updated by the 'loadApplicationData' in the module script via onSnapshot.
        }
        
        // --- Bio Update Modal and Function ---

        function openBioModal() {
            if (!window.appState.isLoggedIn) {
                 return displayMessage('Please login to update your bio.', 'error');
            }
            document.getElementById('bio-update-modal').classList.remove('hidden');
        }

        function closeBioModal() {
            document.getElementById('bio-update-modal').classList.add('hidden');
        }

        function handleBioUpdate(event) {
            event.preventDefault();
            
            const fullName = document.getElementById('bio-full-name').value.trim();
            const program = document.getElementById('bio-program').value;

            // Retrieve existing data to ensure we don't overwrite required fields
            // For a real app, you would fetch the latest document content before updating.
            const applicationData = {
                fullName,
                program
                // The module script handles merging this with existing data or creating a new document if needed
            };

            window.saveApplicationData(applicationData); // Use the same save function, which intelligently updates if docId exists
            closeBioModal();
        }

        // --- Picture and Document Functions (Simulated) ---

        function uploadIdPic() {
            displayMessage('ID Photo Upload feature initiated. In a real app, this would open a file picker and upload to Firebase Storage.', 'success');
             // Simulate updating the picture placeholder
             const newPicUrl = `https://placehold.co/160x160/22c55e/ffffff?text=${window.firebase.userId.substring(0, 5)}%20ID`;
             document.getElementById('portal-id-pic').src = newPicUrl;
        }


        // --- Campus Post Submission Logic ---

        function handlePostSubmit(event) {
            event.preventDefault();
            if (!window.appState.isLoggedIn) {
                 return displayMessage('You must log in to post to the Campus Gallery.', 'error');
            }

            const imageUrl = document.getElementById('post-image-url').value.trim();
            const caption = document.getElementById('post-caption').value.trim();
            
            if (!imageUrl.match(/\.(jpeg|jpg|gif|png|webp|svg)/i)) {
                 return displayMessage('Please enter a valid image URL for the simulation (ending in .jpg, .png, etc.).', 'error');
            }

            const postData = {
                imageUrl,
                caption
            };

            window.saveCampusPost(postData);
        }

    </script>
</body>
</html>